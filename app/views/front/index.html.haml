- set_page_specific_title "Home"

%ul#specialties-menu
  %li.dropdown.no-caret
    %a.specialties-dropdown-toggle{"href" => "javascript:void(0)"}
      All Specialties
      %b.caret

= render 'partials/specialization_dropdown_menu'

%script{"type" => "text/javascript"}
  $(document).ready(function() { update_favorites() });

.content-wrapper
  .content#front{:style => current_user.as_admin_or_super? && 'margin-top: -15px'}

    - if current_user.as_admin_or_super?
      .row
        .span12
          Show front page for:
          %ul.nav.nav-pills
            - Division.all.each do |division|
              %li{:class => (division == @as_division) && 'active'}
                = link_to division.name, root_path(division_id: division.id)
      %hr

    - if @news_items.any?
      .row
        .span12
          - @news_items.each do |news_item|
            .news_item.breaking
              .news_item_date= news_item.date if news_item.date.present?
              %div{:class => news_item.date.present? ? "news_item_title" : "news_item_date"}= news_item.title if news_item.title.present?
              .news_item_body
                = BlueCloth.new(news_item.body).to_html.html_safe

    .row
      .span3.hidden-phone.front

        %h2 Specialties

        %ul.space
          - @specializations.each do |specialization|
            %li
              = link_to specialization.name, specialization, :class => specialization.fully_in_progress_for_divisions(@as_divisions) ? "in-progress ajax" : "ajax hoverlabel"
              = "<span class='new'>new</span>".html_safe if specialization.new_for_divisions(@as_divisions)

      .span4half.front

        %h2 What is Pathways?

        %p
          Pathways is a web based resource to streamline and optimize patient referrals.
          = "<a href='javascript:void(0)' data-toggle='collapse' data-target='#what_is'>Learn more.</a>".html_safe

        #what_is.collapse
          %p
            Originally a project of the Fraser NW Division of Family Practice, Pathways provides a comprehensive, searchable database of specialists, specialty clinics and services organized by specialty.

          %p
            Pathways contributes to improved patient outcomes by
            %strong incorporating learnings from our Shared Care initiatives,
            including decision tools, care pathways, pearls, red flags, and patient education materials.

          %p
            If you have any comments or questions while using the site, please contact us at
            = mail_to "administration@pathwaysbc.ca", "administration@pathwaysbc.ca"

        %h2 Latest Specialist and Clinic Updates
        - if ENV["HIDE_LATEST_UPDATES"] != "true"
          - LatestUpdates.for(:front, @as_divisions).each do |event|
            %p= event[:markup]

        %p
          = link_to "More...", @more_updates_url

        - if current_user.as_admin_or_super? && @can_edit_division
          %p.admin.btn-group
            = link_to "<i class='icon-pencil'></i> Edit Manual Specialist and Clinic Updates".html_safe,
              news_items_path(division_id: @as_division.id),
              :class => "btn btn-mini ajax"

        - if @current_newsletter.present?
          %div{style: "margin-top: 18px;"}
            %h2 Pathways Newsletter

            %div{style: "margin-top: 10px;"}
              = image_tag "pathways_newsletter.png", style: "height: 120px; border: 1px solid lightgray; padding: 2px; margin-right: 10px; float: left;"
              %p{style: "margin-top: 0px;"}
                = "The current Pathways newsletter (#{@current_newsletter.month} Edition) is available #{link_to('here', @current_newsletter.url, target: '_blank')}.  It includes:".html_safe
              %ul{style: "margin-bottom: 20px;"}
                - @current_newsletter.description_items.each do |item|
                  %li{style: "list-style-type: disc;"}
                    = item.description_item
              %p
                = "You can also #{link_to('browse previous issues', newsletters_path)}.".html_safe
              %div{style: "clear: both;"}

        - if @divisional_updates.any?

          %h2 Division Updates

          - @divisional_updates.each do |news_item|

            .news_item
              .news_item_date= news_item.date if news_item.date.present?
              %div{:class => news_item.date.present? ? "news_item_title" : "news_item_date"}= news_item.title if news_item.title.present?
              .news_item_body
                = BlueCloth.new(news_item.body).to_html.html_safe

        - if @can_edit_division
          %p.admin.btn-group
            = link_to("<i class='icon-pencil'></i>".html_safe + " Edit Division Updates", news_items_path(division_id: @as_division.id), :class => "btn btn-mini ajax")

        - if @attachment_updates.any?

          %h2 Attachment Updates

          - @attachment_updates.each do |news_item|

            .news_item
              .news_item_date= news_item.date if news_item.date.present?
              %div{:class => news_item.date.present? ? "news_item_title" : "news_item_date"}= news_item.title if news_item.title.present?
              .news_item_body
                = BlueCloth.new(news_item.body).to_html.html_safe

        - if current_user.as_admin_or_super? && @can_edit_division
          %p.admin.btn-group
            = link_to("<i class='icon-pencil'></i>".html_safe + " Edit Attachment Updates", news_items_path(division_id: @as_division.id), :class => "btn btn-mini ajax")

        - if @shared_care_updates.any?

          %h2
            %i.icon-red.icon-star
            Shared Care Updates

          - @shared_care_updates.each do |news_item|

            .news_item
              .news_item_date= news_item.date if news_item.date.present?
              %div{:class => news_item.date.present? ? "news_item_title" : "news_item_date"}= news_item.title if news_item.title.present?
              .news_item_body
                = BlueCloth.new(news_item.body).to_html.html_safe

        - if current_user.as_admin_or_super? && @can_edit_division
          %p.admin.btn-group
            = link_to("<i class='icon-pencil'></i>".html_safe + " Edit Shared Care Updates", news_items_path(division_id: @as_division.id), :class => "btn btn-mini ajax")


      .span4.offsethalf

        .well

          %h2.center Featured Content

          - cache(rand()) do
            - ScCategory.front_page_for_divisions(@as_divisions).each do |category|
              %h3
                = link_to sc_category_path(category),
                  class: 'ajax' do
                  %span= category.name
                  %span.all
                    %span= " - Browse All"
                    %i.icon-arrow-right.icon-blue.icon-small

              %table.featured_contents__table
                %tbody
                  - category.featured_for_divisions(@as_divisions).each do |featured_sc_item|
                    %tr
                      %td.featured_contents__table_cell
                        .dropdown.featured_contents__dropdown
                          %a.dropdown-toggle{"href" => "#", "data-toggle" => "dropdown"}
                            %span.icon-stack.featured_contents__arrow_icon_stack
                              %i.icon-check-empty.icon-stack-base.icon-text.featured_contents__arrow_icon_box
                              %i.icon-caret-down.icon-text.featured_contents__arrow_icon_caret
                          %ul.dropdown-menu.featured_contents__dropdown_menu
                            %li.featured_contents__dropdown_item
                              = link_to "javascript:void(0)",
                                onclick: "pathways.favoriteFeaturedItem(event, #{featured_sc_item.id},' #{escape_javascript(featured_sc_item.title)}')",
                                title: "Favourite / un-favourite",
                                class: "featured_contents__dropdown_link" do
                                %i.icon-heart.icon-text{id: "user_favorite_content_items_#{featured_sc_item.id}"}
                                %span.featured_contents__dropdown_item_text
                                  = "Favorite"
                            - if featured_sc_item.can_email?
                              %li.featured_contents__dropdown_item
                                = link_to compose_mail_to_patients_path(featured_sc_item),
                                  title: "E-mail to Patient",
                                  class: "featured_contents__dropdown_link" do
                                  %i.icon-envelope-alt.icon-blue
                                  %span.featured_contents__dropdown_item_text
                                    = "Email"
                            %li.featured_contents__dropdown_item
                              = link_to "javascript:void(0)",
                                onClick: "window.pathways.feedbackModal.setState({id: #{featured_sc_item.id}, itemType: 'ScItem', title: '#{featured_sc_item.title}', modalState: 'PRE_SUBMIT'})",
                                class: "featured_contents__dropdown_link" do
                                %i.icon-bullhorn.icon-blue
                                %span.featured_contents__dropdown_item_text
                                  = "Send Feedback"
                      %td.featured_contents__table_cell
                        = link_to featured_sc_item.title,
                          featured_sc_item.resolved_url,
                          class: featured_sc_item.markdown? && "ajax",
                          target: "_blank",
                          onclick: "window.pathways.trackContentItem(_gaq, #{featured_sc_item.id})"

          .featured-content
            %i.icon-star.icon-blue
            %span= "Indicates content from our Shared Care initiative"

        - if current_user.as_admin_or_super? && @can_edit_division
          %p.admin.btn-group
            = link_to edit_featured_contents_path(division_id: @as_divisions.first.id),
              class: "btn btn-mini ajax" do
              %i.icon-pencil
              %span= "Edit Featured Content"

#feedback_modal

:javascript
  window.pathways.favoriteFeaturedItem = function(event, id, title) {
    event.stopPropagation();

    favorite('content_items', id, title);
  };
  window.pathways.bootstrapFeedbackModal('feedback_modal', {});
